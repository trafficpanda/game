from dataclasses import dataclass
from typing import List, Dict


@dataclass
class StoryChapter:
    id: str
    day: int
    title: str
    text: str


CHAPTERS: Dict[str, StoryChapter] = {
    "ch1": StoryChapter(
        id="ch1",
        day=1,
        title="Пробуждение Панды",
        text=(
            "Твоя панда просыпается в мире арбитража. Всё вокруг — офферы, "
            "источники трафика и люди, которые пытаются заработать на внимании.\n\n"
            "Твоя задача — помочь панде сделать первые шаги: понять базу и не сгореть на старте."
        ),
    ),
    "ch2": StoryChapter(
        id="ch2",
        day=2,
        title="Поиск Оффера",
        text=(
            "Панда понимает, что без хорошего оффера далеко не уйти. "
            "Она знакомится с партнёрскими сетями, изучает вертикали и payout.\n\n"
            "Где-то там ждёт связка, которая выстрелит."
        ),
    ),
    "ch3": StoryChapter(
        id="ch3",
        day=3,
        title="Мастер Трафика",
        text=(
            "В игру вступают источники трафика. Панда пытается понять, чем Meta отличается от TikTok, "
            "а почему в Telegram иногда конверсия выше.\n\n"
            "Теперь главное — не запутаться и фокусироваться."
        ),
    ),
    "ch4": StoryChapter(
        id="ch4",
        day=4,
        title="Тень Банхантера",
        text=(
            "Каждый арбитражник рано или поздно встречает бан. "
            "Панда учится проходить модерацию, не нарушая правил, и не терять доступ к аккаунтам."
        ),
    ),
    "ch5": StoryChapter(
        id="ch5",
        day=5,
        title="Подземелье CR",
        text=(
            "Трафика много, но заказов мало. В чём проблема — креатив, лендинг или колл-центр?\n\n"
            "Панда спускается в подземелье метрик, чтобы найти слабое звено."
        ),
    ),
    "ch6": StoryChapter(
        id="ch6",
        day=6,
        title="Храм ROI",
        text=(
            "В храме ROI каждому вопросу есть цена. Панда учится считать "
            "прибыль и не задавать лишних вопросов, пока нет данных.\n\n"
            "Настоящий арбитражник не льёт 'на авось'."
        ),
    ),
    "ch7": StoryChapter(
        id="ch7",
        day=7,
        title="Последняя Связка",
        text=(
            "После всех тестов и ошибок панда находит связку, которая даёт стабильный плюс. "
            "Но это не конец — это только начало настоящей игры."
        ),
    ),
}


def get_unlocked_chapters(completed_steps_count: int) -> List[StoryChapter]:
    """
    Примитивная логика:
    - каждый день ~ 3 шага,
    - значит каждые 3 завершённых шага открываем новую главу.
    """
    approx_day = max(1, min(7, completed_steps_count // 3 + 1))
    return [c for c in CHAPTERS.values() if c.day <= approx_day]
